const page_data = { //Swiper里的文字介绍数据
    single: [{
        name: "社会经济",
        des: "学生和群众的抵制日货，一定条件下刺激了民族产业的发展，但是随着一战的结束，中国的社会经济依然无法摆脱遭受日本欺凌的厄运。美国哥伦比亚大学商学院副教授多雷西·欧查德（Dorothy J. Orchard）总结说，无论如何，“中国使用‘抵制’这一经济武器，是现代经济史最有启示的篇章。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    }, //第一个为占位符
    {
        name: "事件起因",
        des: "第一次世界大战期间，欧洲列强无暇东顾，日本趁机加强对中国的侵略，严重损害了中国的主权。中国人民的反日情绪日渐增长。1919年1月，英、美、法、日、意等战胜国在巴黎召开对德和会，决定由日本继承德国在中国山东的特权。中国是参加对德宣战的战胜国之一，但北洋军阀政府却准备接受这个决定。这次和会上中国外交的失败，引发了伟大的五四运动。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    },
    {
        name: "历史特点",
        des: "第一，五四运动表现了反帝反封建的彻底性。第二，五四运动是一次真正的群众运动。第三，五四运动促进了马克思主义在中国的传播及其与中国工人运动的结合。第四，五四运动是由学生先发起，由工人扩大的坚决的反帝运动，是无产阶级领导的新民主主义革命。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    },
    {
        name: "主要影响",
        des: "五四爱国运动，是一次彻底地反对帝国主义和封建主义的爱国运动（性质），是中国新民主主义的开始；青年学生起了先锋作用；中国无产阶级开始登上政治舞台；传播了马克思主义。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    },
    {
        name: "伟大五四精神",
        des: "五四运动，孕育了以爱国、进步、民主、科学为主要内容的伟大五四精神，其核心是爱国主义精神。爱国主义是我们民族精神的核心，是中华民族团结奋斗、自强不息的精神纽带。历史深刻表明，爱国主义自古以来就流淌在中华民族血脉之中，去不掉，打不破，灭不了，是中国人民和中华民族维护民族独立和民族尊严的强大精神动力，只要高举爱国主义的伟大旗帜，中国人民和中华民族就能在改造中国、改造世界的拼搏中迸发出排山倒海的历史伟力。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    },
    {
        name: "教育变革",
        des: "杜威的实用主义教育思想和“自动主义”、“自律辅导主义”等教育思想在五四推动下，教育界引起巨变，北京高等师范学校废除学监制，在“开放女禁”呼声下，1919年秋，北京大学、南京高等师范、岭南大学开始破例招收女生，在教育制度上，妇女权利在五四影响下发生变革。1921年10月，北京政府颁布了《学校系统改革案》（壬戊学制），小学六年，初中四年，高中两年，大学四至六年，以美国为蓝本，教育得到革新。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    },
    {
        name: "政治变革",
        des: "五四运动使苏俄在中国播下无产阶级暴力革命的种子，中国共产党的成立和国民党的改组便充分显示出当时布尔什维克革命是当时半封建半殖民地中国的唯一出路，但也有人认为当时对暴力革命的绝对化，对中国的长远发展是一种破坏而非建设作用。",
        url: "https://baike.baidu.com/item/%E4%BA%94%E5%9B%9B%E8%BF%90%E5%8A%A8/291670"
    }
    ],
    online: [{
        name: "",
        des: "《原神》是由上海米哈游制作发行的一款开放世界冒险游戏。游戏发生在一个被称作“提瓦特”的幻想世界，在这里，被神选中的人将被授予“神之眼”，导引元素之力。玩家将扮演一位名为“旅行者”的神秘角色，在自由的旅行中邂逅性格各异、能力独特的同伴们，和他们一起击败强敌，找回失散的亲人——同时，逐步发掘“原神”的真相。"
    },
    {
        name: "中国共产主义青年团",
        des: "中国共产主义青年团是中国共产党领导的先进青年的群团组织，是广大青年在实践中学习中国特色社会主义和共产主义的学校，是中国共产党的助手和后备军。中国共产党领导是中国特色社会主义最本质的特征，是中国特色社会主义制度的最大优势。中国共产主义青年团坚决拥护中国共产党的纲领，以马克思列宁主义、毛泽东思想、邓小平理论、“三个代表”重要思想、科学发展观、习近平新时代中国特色社会主义思想为行动指南。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    },
    {
        name: "组织性质",
        des: "中国共产主义青年团是中国共产党领导的先进青年的群团组织，是广大青年在实践中学习中国特色社会主义和共产主义的学校，是中国共产党的助手和后备军。中国共产党领导是中国特色社会主义最本质的特征，是中国特色社会主义制度的最大优势。中国共产主义青年团坚决拥护中国共产党的纲领，以马克思列宁主义、毛泽东思想、邓小平理论、“三个代表”重要思想、科学发展观、习近平新时代中国特色社会主义思想为行动指南。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    },
    {
        name: "组织成员",
        des: "年龄在十四周岁以上，二十八周岁以下的中国青年，承认团的章程，愿意参加团的一个组织并在其中积极工作、执行团的决议和按期交纳团费的，可以申请加入中国共产主义青年团。团员年满二十八周岁，没有担任团内职务，应该办理离团手续。团员加入共产党以后仍保留团籍，年满二十八周岁，没有在团内担任职务，不再保留团籍。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    },
    {
        name: "领导体制",
        des: "中国共产主义青年团是按照民主集中制组织起来的统一整体。团的全国领导机关，是团的全国代表大会和它产生的中央委员会。地方各级团的领导机关，是同级团的代表大会和它产生的团的委员会，团的各级委员会向同级代表大会负责并报告工作。有关全团性的工作，由团的中央委员会作出决定，统一部署。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    },
    {
        name: "基层组织",
        des: "企业、农村、机关、学校、科研院所、街道社区、社会组织、人民解放军连队、人民武装警察部队中队和其他基层单位，凡是有团员三人以上的，都应当建立团的基层组织。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    },
    {
        name: "形象标识",
        des: "团旗：中国共产主义青年团团旗旗面为红色，象征革命胜利；左上角缀黄色五角星，周围环绕黄色圆圈，象征中国青年一代紧密团结在中国共产党周围。团徽：中国共产主义青年团团徽的内容为团旗、齿轮、麦穗、初升的太阳及其光芒，写有“中国共青团”五字的绶带。它象征着共青团在马克思列宁主义、毛泽东思想的光辉照耀下，团结各族青年，朝着党所指引的方向奋勇前进。团歌：中国共产主义青年团团歌为《光荣啊，中国共青团》。",
        url: "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E5%85%B1%E4%BA%A7%E4%B8%BB%E4%B9%89%E9%9D%92%E5%B9%B4%E5%9B%A2/405736?fromtitle=%E5%85%B1%E9%9D%92%E5%9B%A2&fromid=215034&fr=aladdin#5"
    }
    ]
}
top = ['210vh', 'calc(210vh + 253px)', 'calc(210vh + 506px)', 'calc(210vh)', 'calc(210vh + 253px)', 'calc(210vh + 506px)'];

left = ['234px', '144px', '218px'];

function pow(x, n) {
    let ret = 1;
    for (let i = 0; i < n; i++) {
        ret *= x;
    }
    return ret;
}

function easeInQuart(x) {
    return x * x * x * x;
}

function easeInOutCubic(x) {
    return x < 0.5 ? 4 * x * x * x : 1 - pow(-2 * x + 2, 3) / 2;
}

let animated = { s2: false, s3: false };
window.addEventListener('scroll', () => {
    let scrolled = (document.documentElement.scrollTop) / (document.documentElement.clientHeight); // 当前在第几分屏
    //分屏：0-1：游戏与电子竞技 1-2两个查看详情图 2-3视频全屏->缩小
    console.log(scrolled);
    let siders = document.querySelectorAll('.sider');
    let banner = document.querySelector('.banner .span.hidden');
    let video = document.querySelectorAll('.video-section video')[0];
    let img = document.querySelectorAll('.video-section img')[0];
    let s3wrapper = document.querySelectorAll('.screen.s3 .wrapper svg');
    let WHRate = 1.77777778;
    let sides = document.querySelectorAll('.sidebar .side');
    //----分页器----
    for (side of sides) {
        side.classList.remove("colored");
    }
    if (scrolled < 0.75) sides[0].classList.add("colored");
    if (scrolled > 0.75 && scrolled < 1.75) sides[1].classList.add("colored");
    if (scrolled > 1.75 && scrolled < 3.75) sides[2].classList.add("colored");
    if (scrolled > 3.75 && scrolled < 4.5) sides[3].classList.add("colored");
    if (scrolled > 4.5) sides[4].classList.add("colored");
    //----第一屏----
    if (timer != -1 && scrolled > 0.8) {
        clearInterval(timer);
        timer = -1;
        document.getElementById("bgVideo").pause();
        $("#bgVideo").css("display", "none");
    }
    if (timer == -1 && scrolled < 0.5) {
        $("#bgVideo").css("display", "block");
        document.getElementById("bgVideo").play();
    }
    //----banner附加文字----
    if (scrolled > 1.75) {
        banner.style.opacity = 1;
    } else {
        banner.style.opacity = 0;
    }
    //----页面动画----
    if (scrolled >= 0.85) {
        $(".banner").css("opacity", 1);
    } else {
        $(".banner").css("opacity", 0);
    }
    if (!animated["s2"] && scrolled > 0.6) {
        $("#warpper1,#warpper2").css("animation-play-state", "running");
        $(".skew .line").fadeIn();
        $(".screen.s2 .wrapper .btn").css("opacity", 1);
        animated["s2"] = true;
    }
    if (scrolled < 2) {
        video.style.width = "106.52vw"; // 1944 / 18.25 + 'vw';
        img.style.width = "107.56vw"; // 1963 / 18.25 + 'vw';
    }
    if (scrolled > 2 && scrolled < 3) {
        let width = 747 + 1197 * (1 - easeInOutCubic(scrolled - 2)); // 747 + (1944 - 747) * (1 - easeInOutCubic(scrolled - 2));
        video.style.width = width / 18.25 + 'vw';
        img.style.width = width * 1.01 / 18.25 + 'vw';
    }
    if (scrolled > 3) {
        video.style.width = "40.93vw"; // 747 / 18.25 + 'vw';
        img.style.width = "41.315vw"; // 754 / 18.25 + 'vw';
    }
    if (!animated["s3"] && scrolled > 2.9) {
        let i = 1;
        for (sider of siders) {
            sider.style.animation = "getin" + i + " 1s";
            sider.style.visibility = "visible";
            i++;
        }
        animated["s3"] = true;
    }
    if (scrolled < 2.5) {
        for (sider of siders) {
            sider.style.visibility = "hidden";
            sider.style.animation = "";
        }
        animated["s3"] = false;
    }
    if (scrolled < 4) {
        for (item of s3wrapper) {
            item.style.opacity = "0";
        }
    }
    if (scrolled > 3.7) {
        for (item of s3wrapper) {
            item.style.opacity = "1";
        }
        $(".imgContainer").css("opacity", 1);
        $("#b1").text("过去");
        $("#b2").text("和未来");
    }
    if (scrolled > 4.5) {
        $("#s5l1, #s5l2, #s5l3").css({
            opacity: 1,
            transform: "none"
        });
    }
})

let timer = -1;
$(document).ready(function () {
    $("#s1l1, #s1l2, #s1l3").css({
        opacity: 1,
        transform: "none"
    });
    setTimeout(() => {
        $("#bgVideo").fadeIn(1000);
        $(".promote").fadeIn(2000);
    }, 1500);
    timer = setInterval(function () {
        $(".promote").animate({
            bottom: "+=50px"
        }, {
            duration: 2000
        }).queue(function (next) {
            $(".promote").fadeOut(function () {
                $(".promote").css("bottom", "0");
            });
            next();
        }).queue(function (next) {
            $(".promote").fadeIn();
            next();
        });
    }, 10000);
    let mySwiper = new Swiper('.swiper-container', {
        direction: 'horizontal',
        effect: 'slide',
        observeParents: true,
        observer: true,
        slidesPerView: 3,
        loop: false,
        virtualTranslate: true,
        speed: 500,
        centeredSlides: true,
        allowTouchMove: false,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        }
    });
    mySwiper.on('slideChange', function () {
        console.log(mySwiper.realIndex);
        if (status[0]) {
            if (mySwiper.realIndex > page_data.single.length) {
                $("#gameName").text(page_data.single[0].name);
                $("#gameDes").text(page_data.single[0].des);
                $("#gameSite").attr("href", page_data.single[0].url);
            } else {
                $("#gameName").text(page_data.single[mySwiper.realIndex + 1].name);
                $("#gameDes").text(page_data.single[mySwiper.realIndex + 1].des);
                $("#gameSite").attr("href", page_data.single[mySwiper.realIndex + 1].url);
            }
        } else if (status[1]) {
            if (mySwiper.realIndex > page_data.online.length) {
                $("#gameName").text(page_data.online[0].name);
                $("#gameDes").text(page_data.online[0].des);
                $("#gameSite").attr("href", page_data.online[0].url);
            } else {
                $("#gameName").text(page_data.online[mySwiper.realIndex + 1].name);
                $("#gameDes").text(page_data.online[mySwiper.realIndex + 1].des);
                $("#gameSite").attr("href", page_data.online[mySwiper.realIndex + 1].url);
            }
        }
    });
    let status = [false, false];
    let slides = document.querySelectorAll('.swiper-container .skew-fix img');
    $("#more1").click(function (e) {
        e.preventDefault();
        let line = document.querySelector('.screen.s2 .wrapper .skew');
        if (!status[0]) {
            let i = 0;
            slides.forEach(slide => {
                if (i == 0) slide.setAttribute("src", "./source/img/page/6.jpg");
                else slide.setAttribute("src", "./source/img/page/" + i + ".jpg");
                i++;
            });
            line.style.transform = "translate(-18.5vw,0)";
            $(".swiper-container").fadeIn();
            $(".mask").css("display", "flex");
            $("#more1 svg text tspan").html("&nbsp;&nbsp;&nbsp;&nbsp;关&nbsp;闭");
            $("#warpper1").css({
                transform: "translate(-20%,-20%)"
            });
            $("#gameName").text(page_data.single[1].name);
            $("#gameDes").text(page_data.single[1].des);
            $("#gameSite").attr("href", page_data.single[1].url);
        } else {
            mySwiper.slideTo(0, 0);
            line.style.transform = "translate(0px,0)";
            $(".swiper-container").fadeOut();
            $(".mask").fadeOut();
            $("#more1 svg text tspan").html("了解更多");
            $("#warpper1").css({
                transform: "none"
            });
        }
        status[0] = !status[0];
    });
    $("#more2").click(function (e) {
        e.preventDefault();
        let line = document.querySelector('.screen.s2 .wrapper .skew');
        if (!status[1]) {
            let i = page_data.single.length - 1;
            slides.forEach(slide => {
                if (i == 6) slide.setAttribute("src", "./source/img/page/" + (2 * i) + ".jpg");
                else slide.setAttribute("src", "./source/img/page/" + i + ".jpg");
                i++;
            });
            line.style.transform = "translate(15vw,0)";
            $(".swiper-container").fadeIn();
            $("#gameName").text(page_data.online[1].name);
            $("#gameDes").text(page_data.online[1].des);
            $("#gameSite").attr("href", page_data.online[1].url);
            $(".mask").css("display", "flex");
            $(".mask h3").css("padding-right", "15%");
            $(".swiper-container").css({
                left: "-22%",
                right: "auto"
            });
            $(".mask").css({
                left: "-100px",
                right: "auto",
                width: "50%"
            });
            $("#warpper2").css({
                transform: "translate(20%,24%)"
            });
            $("#more2 svg text tspan").html("&nbsp;&nbsp;&nbsp;&nbsp;关&nbsp;闭");
        } else {
            mySwiper.slideTo(0, 0);
            line.style.transform = "translate(0px,0)";
            $(".swiper-container").fadeOut();
            $(".mask").fadeOut(() => {
                $(".mask").css({
                    left: "auto",
                    right: "0",
                    width: "80vw"
                });
                $(".swiper-container").css({
                    left: "auto",
                    right: "0"
                });
            });
            $(".mask h3").css("padding-right", "50%");
            $("#warpper2").css({
                transform: "none"
            });
            $("#more2 svg text tspan").html("了解更多");
        }
        status[1] = !status[1];
    });
    $("#hof").click(function (e) {
        e.preventDefault();
        $("#waterflow").fadeIn();
        $(".closeBtn").fadeIn();
        $("#b1").text("五四");
        $("#b2").text("先驱");
        $(".sidebar, .imgContainer").css("filter", "blur(10px)");
    });
    $("#tl").click(function (e) {
        e.preventDefault();
        $("#timeline").fadeIn();
        $(".closeBtn").fadeIn();
        $("#b1").text("共青团");
        $("#b2").text("发展史");
        $(".sidebar").css("filter", "blur(15px)");
    });
    $(".closeBtn").click(function (e) {
        e.preventDefault();
        $(".sidebar, .imgContainer").css("filter", "none");
        $("#waterflow").fadeOut();
        $("#timeline").fadeOut();
        $(".closeBtn").fadeOut();
        $("#b1").text("过去和");
        $("#b2").text("未来");
    });
    $(".sider").hover(function (e) {
        console.log(e);
        $(".text-view." + e.currentTarget.classList[1]).addClass("hover");
    }, function (e) {
        $(".text-view." + e.currentTarget.classList[1]).removeClass("hover");
    });
    $("#hof").hover(function () {
        $("#iC1 img").addClass("hover");
    }, function () {
        $("#iC1 img").removeClass("hover");
    }
    );
    $("#tl").hover(function () {
        $("#iC2 img").addClass("hover");
    }, function () {
        $("#iC2 img").removeClass("hover");
    }
    );
});
